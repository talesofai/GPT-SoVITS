# 性能测试

## 过程
### 配置
GPU: 3080x2 20GB
CPU: Intel(R) Xeon(R) CPU E5-2680 v4 @ 2.40GHz

按照顺序取模的方式从下面选择句子进行生成
```python
jokes = [
    "为什么程序员总是冷静？因为他们有很多漏洞可以修复。",
    "有一天，我对我的电脑说：“你是我的最好朋友！”然后它蓝屏了。",
    "为什么程序员不喜欢去海滩？因为他们害怕沙盒。",
    "为什么数据库管理员是最好的心理医生？因为他们总是处理关系问题。",
    "为什么程序员喜欢喝凉水？因为他们喜欢“冷静”。",
    "为什么前端开发人员总是穿着凉鞋？因为他们喜欢在浏览器中“脱鞋”。",
    "为什么程序员总是饿着肚子？因为他们喜欢“循环”。",
    "为什么程序员喜欢猫？因为它们有九条“线程”。",
    "为什么程序员不喜欢赌博？因为他们不喜欢“风险”。",
    "为什么程序员不喜欢打电话？因为他们害怕“接口”。"
]
```

Batch Size 分别选取 `1,8,16,32,64 `

### 结果

| Batch Size | 角色 | 平均时间 | 最短时间 | 最长时间 |
|---|---|---|---|---|
| 1 | 散兵 | 2.5210071951150894 | 1.776733160018921 | 4.026009798049927 |
| 1 | 明日香 | 2.2492114305496216 | 1.4477417469024658 | 3.0919113159179688 |
| 1 | 温迪 | 1.891553372144699 | 1.155186653137207 | 2.468488931655884 |
| 1 | 灰原哀 | 2.4168067574501038 | 1.832143783569336 | 3.4661378860473633 |
| 1 | 纳西妲 | 2.4466719031333923 | 1.8412814140319824 | 3.4720942974090576 |
| 1 | 芙宁娜 | 1.9744996577501297 | 1.4581043720245361 | 2.6082608699798584 |
| 1 | 芙莉莲 | 1.820035994052887 | 1.460545539855957 | 2.7001936435699463 |
| 1 | 钟离 | 2.760923743247986 | 1.6540131568908691 | 3.7202131748199463 |
| 1 | 雷电将军 | 2.1682086288928986 | 1.6967151165008545 | 2.6610336303710938 |
| 1 | 饮月 | 2.174799844622612 | 1.6491990089416504 | 3.1596622467041016 |
| 8 | 散兵 | 2.0779851973056793 | 1.283745288848877 | 3.2764461040496826 |
| 8 | 明日香 | 2.5094552040100098 | 1.6907763481140137 | 3.895672559738159 |
| 8 | 温迪 | 1.8174388706684113 | 1.3471083641052246 | 2.65096116065979 |
| 8 | 灰原哀 | 2.5321962237358093 | 1.9251806735992432 | 3.944305181503296 |
| 8 | 纳西妲 | 2.468187555670738 | 1.9149489402770996 | 3.2831757068634033 |
| 8 | 芙宁娜 | 1.9799010902643204 | 1.4930777549743652 | 2.7005908489227295 |
| 8 | 芙莉莲 | 1.8333721905946732 | 1.4442312717437744 | 2.6194803714752197 |
| 8 | 钟离 | 2.8559149503707886 | 1.9293456077575684 | 4.565668106079102 |
| 8 | 雷电将军 | 2.1682765185832977 | 1.6853222846984863 | 2.818042039871216 |
| 8 | 饮月 | 2.1395240277051926 | 1.7272143363952637 | 2.6843791007995605 |
| 16 | 散兵 | 2.399371311068535 | 1.0584745407104492 | 3.850003242492676 |
| 16 | 明日香 | 2.139318570494652 | 1.5778827667236328 | 3.4926931858062744 |
| 16 | 温迪 | 1.7763365656137466 | 1.4616162776947021 | 2.445399045944214 |
| 16 | 灰原哀 | 2.423201397061348 | 1.8414969444274902 | 3.5581247806549072 |
| 16 | 纳西妲 | 2.2484907060861588 | 1.5835630893707275 | 3.1821796894073486 |
| 16 | 芙宁娜 | 1.9459258466959 | 1.0341017246246338 | 2.5305545330047607 |
| 16 | 芙莉莲 | 1.8930166959762573 | 1.4877538681030273 | 2.7691519260406494 |
| 16 | 钟离 | 2.574592337012291 | 1.823462963104248 | 3.540255308151245 |
| 16 | 雷电将军 | 2.240467220544815 | 1.7766122817993164 | 3.7364039421081543 |
| 16 | 饮月 | 2.185122460126877 | 1.7893927097320557 | 2.6312012672424316 |
| 32 | 散兵 | 2.16532002389431 | 1.0193133354187012 | 3.388880729675293 |
| 32 | 明日香 | 2.4862136840820312 | 1.5511484146118164 | 4.593113422393799 |
| 32 | 温迪 | 1.8837589472532272 | 1.528385877609253 | 2.343966245651245 |
| 32 | 灰原哀 | 2.5135009735822678 | 1.9748799800872803 | 3.5209596157073975 |
| 32 | 纳西妲 | 2.4656807631254196 | 2.0242443084716797 | 3.3991291522979736 |
| 32 | 芙宁娜 | 2.2565074265003204 | 1.5657854080200195 | 2.861919641494751 |
| 32 | 芙莉莲 | 1.9365229606628418 | 1.5963013172149658 | 3.1458899974823 |
| 32 | 钟离 | 2.960356831550598 | 1.8347675800323486 | 4.558746576309204 |
| 32 | 雷电将军 | 2.267617404460907 | 1.670628309249878 | 3.7685396671295166 |
| 32 | 饮月 | 2.178442284464836 | 1.724600076675415 | 2.8731164932250977 |
| 64 | 散兵 | 2.2769753634929657 | 1.4010231494903564 | 3.4905827045440674 |
| 64 | 明日香 | 2.8093208223581314 | 1.6550273895263672 | 7.119682550430298 |
| 64 | 温迪 | 1.9955617934465408 | 1.4258642196655273 | 2.7784202098846436 |
| 64 | 灰原哀 | 2.5818295180797577 | 1.9204308986663818 | 3.592599391937256 |
| 64 | 纳西妲 | 2.6590051501989365 | 1.9740793704986572 | 3.555522918701172 |
| 64 | 芙宁娜 | 2.0153624564409256 | 1.7236487865447998 | 2.3410441875457764 |
| 64 | 芙莉莲 | 1.9869149774312973 | 1.644101619720459 | 2.79148006439209 |
| 64 | 钟离 | 2.562631770968437 | 1.765855073928833 | 3.4098093509674072 |
| 64 | 雷电将军 | 2.147110164165497 | 1.6527843475341797 | 2.9387166500091553 |
| 64 | 饮月 | 2.256091922521591 | 1.7733957767486572 | 2.94952654838562 |

处理速度平均： `84it/s`

### 另一套配置
GPU: 4090 24GB
CPU: AMD EPYC 9654 96-Core Processor

### 结果
| Batch Size | 角色 | 平均时间 | 最短时间 | 最长时间 |
|---|---|---|---|---|
| 1 | 散兵 | 0.9195902943611145 | 0.6927516460418701 | 1.67169189453125 |
| 1 | 明日香 | 0.8404235243797302 | 0.5425124168395996 | 1.1504135131835938 |
| 1 | 温迪 | 0.6810178160667419 | 0.47228026390075684 | 0.8643651008605957 |
| 1 | 灰原哀 | 0.9054684042930603 | 0.6466193199157715 | 1.2094099521636963 |
| 1 | 纳西妲 | 0.8983560502529144 | 0.6820018291473389 | 1.1834917068481445 |
| 1 | 芙宁娜 | 0.7528847903013229 | 0.581010103225708 | 0.9928669929504395 |
| 1 | 芙莉莲 | 0.7227364480495453 | 0.5833959579467773 | 1.1266522407531738 |
| 1 | 钟离 | 1.0130436569452286 | 0.7138404846191406 | 1.4118537902832031 |
| 1 | 雷电将军 | 0.8647368252277374 | 0.6095099449157715 | 1.110663890838623 |
| 1 | 饮月 | 0.8452286720275879 | 0.6507959365844727 | 1.1785340309143066 |
| 8 | 散兵 | 1.2495149075984955 | 0.6960873603820801 | 1.9466743469238281 |
| 8 | 明日香 | 1.3498733937740326 | 0.7329976558685303 | 2.3224644660949707 |
| 8 | 温迪 | 1.036431610584259 | 0.6329135894775391 | 1.609774112701416 |
| 8 | 灰原哀 | 1.647709682583809 | 0.8244385719299316 | 2.4688165187835693 |
| 8 | 纳西妲 | 1.4177880734205246 | 1.0528342723846436 | 1.778832197189331 |
| 8 | 芙宁娜 | 1.0784514546394348 | 0.6875724792480469 | 1.5255110263824463 |
| 8 | 芙莉莲 | 0.9705979973077774 | 0.6674587726593018 | 1.7392055988311768 |
| 8 | 钟离 | 1.541582077741623 | 1.1255929470062256 | 1.9451639652252197 |
| 8 | 雷电将军 | 1.3217772841453552 | 1.0311553478240967 | 1.723128080368042 |
| 8 | 饮月 | 1.391472339630127 | 1.154029369354248 | 2.094423294067383 |
| 16 | 散兵 | 1.3527085930109024 | 0.7437331676483154 | 1.9641070365905762 |
| 16 | 明日香 | 1.3987500071525574 | 0.8691885471343994 | 2.4826745986938477 |
| 16 | 温迪 | 1.0930820107460022 | 0.6899094581604004 | 1.4234387874603271 |
| 16 | 灰原哀 | 1.4537850618362427 | 0.9058170318603516 | 2.164161205291748 |
| 16 | 纳西妲 | 0.948490783572197 | 0.7940139770507812 | 1.1057124137878418 |
| 16 | 芙宁娜 | 0.8597024977207184 | 0.6929371356964111 | 1.2103724479675293 |
| 16 | 芙莉莲 | 0.7908289879560471 | 0.6911544799804688 | 1.029632568359375 |
| 16 | 钟离 | 1.048461213707924 | 0.7431623935699463 | 1.3952391147613525 |
| 16 | 雷电将军 | 0.8503075987100601 | 0.7235853672027588 | 1.0986988544464111 |
| 16 | 饮月 | 0.8841772079467773 | 0.7821981906890869 | 1.067676305770874 |
| 32 | 散兵 | 0.9395740330219269 | 0.7237043380737305 | 1.4328999519348145 |
| 32 | 明日香 | 0.9256047755479813 | 0.6632764339447021 | 1.6900277137756348 |
| 32 | 温迪 | 0.7945644557476044 | 0.5926816463470459 | 0.9541373252868652 |
| 32 | 灰原哀 | 1.0037964284420013 | 0.8562440872192383 | 1.4723362922668457 |
| 32 | 纳西妲 | 0.9343461841344833 | 0.7850167751312256 | 1.2018780708312988 |
| 32 | 芙宁娜 | 0.8157901912927628 | 0.6908831596374512 | 1.0502557754516602 |
| 32 | 芙莉莲 | 0.7933551073074341 | 0.6740298271179199 | 0.9846665859222412 |
| 32 | 钟离 | 1.0030409395694733 | 0.7853333950042725 | 1.22684907913208 |
| 32 | 雷电将军 | 0.8896999359130859 | 0.7165873050689697 | 1.2103753089904785 |
| 32 | 饮月 | 0.878724679350853 | 0.6965851783752441 | 1.105478286743164 |
| 64 | 散兵 | 0.9431342780590057 | 0.5029869079589844 | 1.283015489578247 |
| 64 | 明日香 | 0.9664110243320465 | 0.7084853649139404 | 1.6664485931396484 |
| 64 | 温迪 | 0.8073300868272781 | 0.6840114593505859 | 0.9695332050323486 |
| 64 | 灰原哀 | 1.0192850679159164 | 0.8292365074157715 | 1.4407048225402832 |
| 64 | 纳西妲 | 0.9445453584194183 | 0.7958669662475586 | 1.160578727722168 |
| 64 | 芙宁娜 | 0.8351071327924728 | 0.7304971218109131 | 1.0459437370300293 |
| 64 | 芙莉莲 | 0.8196343630552292 | 0.6925766468048096 | 1.0583138465881348 |
| 64 | 钟离 | 1.0874724686145782 | 0.7832679748535156 | 1.540661096572876 |
| 64 | 雷电将军 | 0.8959777802228928 | 0.7444021701812744 | 1.1852531433105469 |
| 64 | 饮月 | 0.9123357236385345 | 0.7818961143493652 | 1.2628533840179443 |

处理速度平均： `218it/s`


# 结论
`Batch Size` 对于生成的结果影响不大，越大的`Batch Size`并不能提高效率
原因可能出自于一句话音频无法有效进行并行处理

最大的瓶颈还是出自于`CPU`中，CPU主频高对于速度提升非常明显
尤其是AMD的CPU远超于老式的Intel

